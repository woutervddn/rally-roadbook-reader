import{_ as W,v as T,S as N,W as L,P as C,a as B,f as R,c as n,b as s,d as u,t as l,w as A,e as c,F as x,g as O,h as _,r as j,i as E,o,n as f}from"./index-DLNmK4aA.js";const I={directives:{"on-long-press":T},components:{SwipeOut:N,SwipeList:L},data(){return{PlayStore:C,SettingsStore:B,activeWP:0,route:{},totalDriven:0,wpDriven:0,loc:{},prevLoc:{},distToNextWP:0,showDistToNext:!1}},methods:{itemClick(i){console.log(i)},swipeEventTrigger(i){i||setTimeout(this.getActive,10)},getActive(){for(let i=0;i<this.route.wpt.length;i++)this.$refs.wps.isRevealed(i)&&(console.log("swiped: ",i),this.$refs.wps.closeActions(i),this.PlayStore.activeWP=i+1)},resetTotalDriven(i){this.totalDriven=0},togglePlayStore(){console.log("toggle"),this.PlayStore.toggle()},toggleReverse(){console.log("toggle reverse"),this.PlayStore.toggleReverse()},getLoc(){const i=a=>{console.log(a),this.prevLoc=this.loc,this.loc=a.coords,this.PlayStore.pause||(console.log("prevDriven",this.totalDriven),this.PlayStore.reverse?(this.totalDriven=this.totalDriven-this.cosineDistanceBetweenPoints(this.prevLoc,this.loc),this.wpDriven=this.wpDriven-this.cosineDistanceBetweenPoints(this.prevLoc,this.loc)):(this.totalDriven=this.totalDriven+this.cosineDistanceBetweenPoints(this.prevLoc,this.loc),this.wpDriven=this.wpDriven+this.cosineDistanceBetweenPoints(this.prevLoc,this.loc))),isNaN(this.totalDriven)&&(this.totalDriven=0),isNaN(this.wpDriven)&&(this.wpDriven=0);let p={latitude:this.route.wpt[this.PlayStore.activeWP]["@_lat"],longitude:this.route.wpt[this.PlayStore.activeWP]["@_lon"]};console.log("WPLoc",p),this.distToNextWP=this.cosineDistanceBetweenPoints(this.loc,p),this.SettingsStore.settings.helpers.autoclear===!0&&this.distToNextWP<15&&this.PlayStore.incrementWP()},t=a=>{Âµ,console.log(t)};navigator.geolocation.getCurrentPosition(i,t),navigator.geolocation.watchPosition(i,t,{enableHighAccuracy:!0,maximumAge:3e4})},cosineDistanceBetweenPoints(i,t){console.log("prevLoc",i,"loc",t);const a=i.latitude,p=i.longitude,e=t.latitude,d=t.longitude,k=6371e3,y=a*Math.PI/180,h=e*Math.PI/180,g=h-y,v=(d-p)*Math.PI/180,b=Math.sin(g/2)*Math.sin(g/2)+Math.cos(y)*Math.cos(h)*Math.sin(v/2)*Math.sin(v/2),w=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))*k;return console.log("delta Distance",w),w},async getDemoRoute(){let i=await await fetch("/terrapirata.gpx").then(t=>t.text()).then(t=>new R.XMLParser({ignoreAttributes:!1,namePrefix:"@_"}).parse(t).gpx);this.route=i,this.PlayStore.route=this.route,this.PlayStore.totalWPs=this.route.wpt.length}},mounted(){this.getDemoRoute(),this.getLoc()}},H={class:"d-flex flex-column"},V={class:"instruments position-sticky"},q={class:"row bg-dark text-white"},z={class:"col-6"},F={key:0,class:"bi bi-play-fill"},X={key:1,class:"bi bi-pause-fill"},G={key:0,class:"bi bi-arrow-left"},K={key:1,class:"bi bi-arrow-right"},J={class:"col-6"},Q={class:"float-end mt-2 mb-2 pt-0 me-2"},U={class:"row d-flex flex-row"},Y={key:0,class:"col-md-2 col-6 flex-fill border-end text-center position-relative bg-info"},Z={class:"text-center user-select-none"},$={key:0},tt={key:1},et={class:"text-center"},st={key:0},ot={key:1},nt={key:2,class:"col-md-2 col-6 flex-fill border-end text-center position-relative bg-success"},it={class:"text-center"},lt={key:0},rt={key:1},ct={key:2},at={key:3},dt={key:3,class:"col-md-2 col-6 flex-fill border-end text-center position-relative bg-warning"},ut={class:"text-center"},pt={key:0},ht={key:1},gt={class:"text-end"},vt={key:0},bt={key:1},wt={class:"route flex-fill mb-5"},yt={class:"card text-center text-white bg-secondary"},mt={class:"card-body my-4"},xt={key:0,class:"card-text"},_t={key:1,class:"card-text"},kt={class:"text-center position-absolute top-50 start-50 translate-middle"},Pt={key:0,class:"col-2 position-relative border-end"},ft={key:0,class:"tucked tucked-bottom fw-bold position-absolute p-2 mb-0 gps-wp-pos"},St={key:1,class:"text-center position-absolute top-50 start-50 translate-middle"},Dt={key:2,class:"text-center position-absolute top-50 start-50 translate-middle"},Mt={class:"col-4 border-end text-center"},Wt=["src"],Tt={class:"position-relative text-center h-100"},Nt=["src"],Lt={key:0,class:"tucked-left tucked-bottom fw-bold position-absolute p-2 bg-warning mb-0"},Ct={key:1,class:"tucked fw-bold position-md-absolute text-end px-2 mb-0 gps-wp-pos"};function Bt(i,t,a,p,e,d){var h,g,P,v,b,w,S,D;const k=j("swipe-list"),y=E("on-long-press");return o(),n("main",H,[s("div",V,[s("div",q,[s("div",z,[s("button",{class:"btn btn-sm btn-secondary text-white ms-2 me-2 mt-1 mb-1",onClick:t[0]||(t[0]=r=>d.togglePlayStore())},[e.PlayStore.pause?(o(),n("i",F)):(o(),n("i",X))]),s("button",{class:"btn btn-sm btn-secondary text-white ms-2 me-2 mt-1 mb-1",onClick:t[1]||(t[1]=r=>d.toggleReverse())},[e.PlayStore.reverse?(o(),n("i",G)):(o(),n("i",K))])]),s("div",J,[s("h5",Q,[t[4]||(t[4]=u("WP ")),s("strong",null,l(e.PlayStore.activeWP+1),1),u(" / "+l(e.PlayStore.totalWPs),1)])])]),s("div",U,[e.SettingsStore.settings.instruments.showTotOdo?A((o(),n("div",Y,[s("h2",Z,[((h=e.route.metadata)==null?void 0:h.extensions["openrally:units"])==="metric"?(o(),n("span",$,l(Math.round(e.totalDriven*.001*100)/100),1)):(o(),n("span",tt,l(Math.round(e.totalDriven*.0006213712*100)/100),1)),t[5]||(t[5]=s("br",null,null,-1)),t[6]||(t[6]=u(" TOT "))])])),[[y,[d.resetTotalDriven,{delay:1e3,modifiers:{stop:!0}}]]]):c("",!0),e.SettingsStore.settings.instruments.showWpOdo?(o(),n("div",{key:1,class:"col-md-2 col-6 flex-fill border-end text-center position-relative bg-secondary",onClick:t[2]||(t[2]=r=>e.wpDriven=0)},[s("h2",et,[((g=e.route.metadata)==null?void 0:g.extensions["openrally:units"])==="metric"?(o(),n("span",st,l(Math.round(e.wpDriven*.001*100)/100),1)):(o(),n("span",ot,l(Math.round(e.wpDriven*.0006213712*100)/100),1)),t[7]||(t[7]=s("br",null,null,-1)),t[8]||(t[8]=u(" WP "))])])):c("",!0),e.SettingsStore.settings.instruments.showSpeed?(o(),n("div",nt,[s("h2",it,[e.loc.speed==null?(o(),n(x,{key:0},[t[9]||(t[9]=s("span",null,"-",-1)),t[10]||(t[10]=s("br",null,null,-1))],64)):(o(),n(x,{key:1},[((P=e.route.metadata)==null?void 0:P.extensions["openrally:units"])==="metric"?(o(),n("span",lt,l(Math.round(e.loc.speed*3.6*100)/100),1)):(o(),n("span",rt,l(Math.round(e.loc.speed*2.23694*100)/100),1)),t[11]||(t[11]=s("br",null,null,-1))],64)),((v=e.route.metadata)==null?void 0:v.extensions["openrally:units"])==="metric"?(o(),n("span",ct,"KMH")):(o(),n("span",at,"MPH"))])])):c("",!0),e.SettingsStore.settings.instruments.showCap?(o(),n("div",dt,[s("h2",ut,[e.loc.heading?(o(),n("span",pt,l(Math.round(e.loc.heading)),1)):(o(),n("span",ht,"-")),t[12]||(t[12]=s("br",null,null,-1)),t[13]||(t[13]=u(" CAP "))])])):c("",!0),e.SettingsStore.settings.instruments.showDebug?(o(),n("div",{key:4,class:"col-md-4 col-12 flex-fill border-end text-end position-relative bg-danger",onClick:t[3]||(t[3]=r=>e.showDistToNext=!e.showDistToNext)},[s("h2",gt,[e.showDistToNext?(o(),n(x,{key:0},[t[14]||(t[14]=s("span",null,"NEXT WP",-1)),t[15]||(t[15]=s("br",null,null,-1)),((b=e.route.metadata)==null?void 0:b.extensions["openrally:units"])==="metric"?(o(),n("span",vt,l(Math.round(e.distToNextWP*.001*100)/100),1)):(o(),n("span",bt,l(Math.round(e.distToNextWP*.0006213712*100)/100),1)),t[16]||(t[16]=s("br",null,null,-1))],64)):(o(),n(x,{key:1},[s("span",null,l(e.loc.latitude),1),t[17]||(t[17]=s("br",null,null,-1)),s("span",null,l(e.loc.longitude),1),t[18]||(t[18]=s("br",null,null,-1))],64))])])):c("",!0)])]),s("div",wt,[s("div",yt,[s("div",mt,[t[19]||(t[19]=s("h5",{class:"card-title"},"Demo Route Title",-1)),((w=e.route.metadata)==null?void 0:w.extensions["openrally:units"])==="metric"?(o(),n("p",xt,l((S=e.route.metadata)==null?void 0:S.extensions["openrally:distance"])+"km",1)):(o(),n("p",_t,l((D=e.route.metadata)==null?void 0:D.extensions["openrally:distance"])+"miles",1))])]),e.route.wpt?(o(),O(k,{key:0,ref:"wps",class:"wps",items:e.route.wpt,"item-key":"name","onSwipeout:click":d.itemClick,onActive:d.swipeEventTrigger},{default:_(({item:r,index:m,revealLeft:Rt,revealRight:At,close:Ot})=>{var M;return[s("div",{class:f(["row border-bottom wpt",m+1>e.PlayStore.activeWP?"bg-white":"bg-cleared"])},[s("div",{class:f(["col-2 position-relative border-end",{"col-2":e.SettingsStore.settings.roadbook.showWPDist,"col-3":!e.SettingsStore.settings.roadbook.showWPDist,"bg-cleared":Math.round(((r==null?void 0:r.extensions["openrally:distance"])-((M=e.route.wpt[m-1])==null?void 0:M.extensions["openrally:distance"]))*100)/100<.5}])},[s("h2",kt,l(r.extensions["openrally:distance"]),1)],2),e.SettingsStore.settings.roadbook.showWPDist?(o(),n("div",Pt,[e.SettingsStore.settings.roadbook.showWPNo?(o(),n("h5",ft,l(r.name),1)):c("",!0),m>0?(o(),n("h2",St,l(Math.round((r.extensions["openrally:distance"]-e.route.wpt[m-1].extensions["openrally:distance"])*100)/100),1)):(o(),n("h2",Dt,"0"))])):c("",!0),s("div",Mt,[s("img",{src:r.extensions["openrally:tulip"]},null,8,Wt)]),s("div",{class:f(["ps-0",e.SettingsStore.settings.roadbook.showWPDist?"col-4":"col-5"])},[s("div",Tt,[s("img",{style:{"z-index":"999"},src:r.extensions["openrally:notes"]},null,8,Nt),e.SettingsStore.settings.roadbook.showCap?(o(),n("h5",Lt,l(r.extensions["openrally:cap"]),1)):c("",!0),e.SettingsStore.settings.roadbook.showGPS?(o(),n("p",Ct,[u(l(r["@_lat"]),1),t[20]||(t[20]=s("br",null,null,-1)),u(l(r["@_lon"]),1)])):c("",!0)])],2)],2)]}),left:_(({item:r})=>t[21]||(t[21]=[s("div",{class:"bg-success",style:{width:"25vw"}},[s("h1",{class:"text-white text-center position-absolute top-50 start-50 translate-middle"},[s("i",{class:"bi bi-check-lg"})])],-1)])),right:_(({item:r})=>t[22]||(t[22]=[s("div",{class:"bg-success",style:{width:"25vw"}},[s("h1",{class:"text-white text-center position-absolute top-50 start-50 translate-middle"},[s("i",{class:"bi bi-check-lg"})])],-1)])),empty:_(()=>t[23]||(t[23]=[s("div",null," No waypoints in this route ",-1)])),_:1},8,["items","onSwipeout:click","onActive"])):c("",!0)])])}const Et=W(I,[["render",Bt],["__scopeId","data-v-f2234f6a"]]);export{Et as default};
